<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Details - Tgen Robotics Hub</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/media-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .robot-detail-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .breadcrumb i {
            font-size: 0.8rem;
        }
        
        .robot-detail-header {
            margin-bottom: 40px;
        }
        
        .robot-title {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .robot-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
        }
        
        .meta-item i {
            color: var(--primary);
        }
        
        .robot-summary {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 30px;
            font-style: italic;
            color: var(--light);
            opacity: 0.9;
        }
        
        .robot-main-image {
            width: 100%;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 40px;
        }
        
        .robot-main-image img {
            width: 100%;
            max-height: 500px;
            object-fit: cover;
        }
        
        .content-tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }
        
        .content-tab {
            padding: 15px 25px;
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.7;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .content-tab.active {
            opacity: 1;
        }
        
        .content-tab::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .content-tab.active::after {
            transform: scaleX(1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--light);
        }
        
        .description {
            line-height: 1.8;
            margin-bottom: 30px;
        }
        
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .spec-item {
            background-color: rgba(18, 18, 18, 0.7);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .spec-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 8px;
        }
        
        .spec-value {
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 500;
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .gallery-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            height: 200px;
            cursor: pointer;
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.5s ease;
        }
        
        .gallery-item:hover img {
            transform: scale(1.1);
        }
        
        .gallery-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 10px 15px;
            background-color: rgba(0, 0, 0, 0.7);
            color: var(--light);
            font-size: 0.9rem;
            transform: translateY(100%);
            transition: all 0.3s ease;
        }
        
        .gallery-item:hover .gallery-caption {
            transform: translateY(0);
        }
        
        .video-section {
            margin-bottom: 40px;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            margin-bottom: 15px;
        }
        
        .video-container iframe,
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }
        
        .video-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .video-description {
            color: var(--gray);
            line-height: 1.6;
        }
        
        .related-robots {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(32, 227, 178, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .admin-actions {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: none; /* Hidden by default, shown only to admins */
        }
        
        .edit-btn, .delete-btn {
            margin-right: 10px;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .modal-content {
            position: relative;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow: auto;
        }
        
        .modal-image img {
            width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .modal-caption {
            margin-top: 10px;
            color: var(--light);
            text-align: center;
            font-size: 1rem;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            color: var(--light);
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .modal-close:hover {
            color: var(--primary);
        }
        
        .modal-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--light);
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-prev {
            left: 20px;
        }
        
        .modal-next {
            right: 20px;
        }
        
        .modal-nav:hover {
            background-color: rgba(32, 227, 178, 0.2);
            color: var(--primary);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .robot-title {
                font-size: 2rem;
            }
            
            .content-tab {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
            
            .specs-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="index.html">
                <img src="images/logo.svg" alt="Tgen Robotics Hub Logo" class="logo">
            </a>
            <nav class="nav-links">
                <a href="encyclopedia.html">Encyclopedia</a>
                <a href="about.html">About</a>
                <a href="contact.html">Contact</a>
            </nav>
            <button class="mobile-menu-button">
                <i class="fas fa-bars"></i>
            </button>
            <div class="auth-buttons">
                <a href="login.html" class="btn btn-outline">Log In</a>
                <a href="signup.html" class="btn btn-primary">Sign Up</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="robot-detail-container">
        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="index.html">Home</a>
            <i class="fas fa-chevron-right"></i>
            <a href="encyclopedia.html">Encyclopedia</a>
            <i class="fas fa-chevron-right"></i>
            <span id="robot-name-breadcrumb">Robot Details</span>
        </div>
        
        <!-- Robot Details -->
        <div id="robot-detail-content">
            <div class="loading-spinner">
                <div class="spinner"></div>
            </div>
        </div>
        
        <!-- Admin Actions (only visible to admins) -->
        <div class="admin-actions" id="admin-actions">
            <button class="btn btn-primary edit-btn" id="edit-robot-btn">
                <i class="fas fa-edit"></i> Edit Robot
            </button>
            <button class="btn btn-danger delete-btn" id="delete-robot-btn">
                <i class="fas fa-trash"></i> Delete Robot
            </button>
        </div>
        
        <!-- Related Robots -->
        <div class="related-robots">
            <h2 class="section-title">Related Robots</h2>
            <div class="robot-grid" id="related-robots">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Image Gallery Modal -->
    <div class="modal-overlay" id="gallery-modal">
        <button class="modal-close" id="modal-close">&times;</button>
        <div class="modal-nav modal-prev" id="modal-prev">
            <i class="fas fa-chevron-left"></i>
        </div>
        <div class="modal-content">
            <div class="modal-image" id="modal-image"></div>
            <div class="modal-caption" id="modal-caption"></div>
        </div>
        <div class="modal-nav modal-next" id="modal-next">
            <i class="fas fa-chevron-right"></i>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>About</h3>
                    <ul class="footer-links">
                        <li><a href="about.html">Our Mission</a></li>
                        <li><a href="about.html#team">The Team</a></li>
                        <li><a href="about.html#partners">Partners</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul class="footer-links">
                        <li><a href="encyclopedia.html">Robot Database</a></li>
                        <li><a href="about.html#research">Research</a></li>
                        <li><a href="about.html#education">Education</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Connect</h3>
                    <ul class="footer-links">
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="contact.html#newsletter">Newsletter</a></li>
                        <li><a href="https://twitter.com/tgenrobotics" target="_blank">Twitter</a></li>
                        <li><a href="https://linkedin.com/company/tgenrobotics" target="_blank">LinkedIn</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2025 Tgen Robotics Hub. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/data.js"></script>
    <script src="js/github-storage.js"></script>
    <script src="robot-storage-adapter.js"></script>
    <script src="robot-media-handler.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script src="js/media-display.js"></script>
    <script>
        // Get the robot slug from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const robotSlug = urlParams.get('slug');
        let currentRobot = null;
        let galleryImages = [];
        let currentImageIndex = 0;
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize storage
            if (window.robotStorage && typeof window.robotStorage.init === 'function') {
                window.robotStorage.init().then(() => {
                    loadRobotDetails();
                });
            } else {
                loadRobotDetails();
            }
            
            // Set up event listeners for the gallery modal
            setupGalleryModal();
            
            // Check if user is an admin
            checkAdminStatus();
        });
        
        // Load robot details
        function loadRobotDetails() {
            if (!robotSlug) {
                showError('Robot not found');
                return;
            }
            
            // Get the robot from the data
            currentRobot = window.robotsData.getRobotBySlug(robotSlug);
            
            if (!currentRobot) {
                showError('Robot not found');
                return;
            }
            
            // Update document title
            document.title = `${currentRobot.name} - Tgen Robotics Hub`;
            
            // Update breadcrumb
            document.getElementById('robot-name-breadcrumb').textContent = currentRobot.name;
            
            // Display the robot details
            displayRobotDetails();
            
            // Load related robots
            loadRelatedRobots();
            
            // Update view count
            updateViewCount();
        }
        
        // Display robot details
        function displayRobotDetails() {
            const detailsContainer = document.getElementById('robot-detail-content');
            
            // Clear the container
            detailsContainer.innerHTML = '';
            
            // Create the detail content
            const detailContent = document.createElement('div');
            
            // Header section
            detailContent.innerHTML = `
                <div class="robot-detail-header">
                    <h1 class="robot-title">${currentRobot.name}</h1>
                    
                    <div class="robot-meta">
                        <div class="meta-item">
                            <i class="fas fa-industry"></i>
                            <span>${currentRobot.manufacturer?.name || 'Unknown Manufacturer'}</span>
                        </div>
                        
                        ${currentRobot.manufacturer?.country ? `
                            <div class="meta-item">
                                <i class="fas fa-globe"></i>
                                <span>${currentRobot.manufacturer.country}</span>
                            </div>
                        ` : ''}
                        
                        ${currentRobot.yearIntroduced ? `
                            <div class="meta-item">
                                <i class="fas fa-calendar"></i>
                                <span>Introduced: ${currentRobot.yearIntroduced}</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <p class="robot-summary">${currentRobot.summary}</p>
                </div>
            `;
            
            // Main image
            let mainImageUrl = 'images/robot-placeholder.jpg';
            if (currentRobot.media) {
                if (currentRobot.media.featuredImage && currentRobot.media.featuredImage.url) {
                    mainImageUrl = currentRobot.media.featuredImage.url;
                } else if (currentRobot.media.mainImage && currentRobot.media.mainImage.url) {
                    mainImageUrl = currentRobot.media.mainImage.url;
                } else if (currentRobot.media.images && currentRobot.media.images.length > 0) {
                    mainImageUrl = currentRobot.media.images[0].url;
                }
            }
            
            detailContent.innerHTML += `
                <div class="robot-main-image">
                    <img src="${mainImageUrl}" alt="${currentRobot.name}" onerror="this.src='images/robot-placeholder.jpg'">
                </div>
            `;
            
            // Content tabs
            detailContent.innerHTML += `
                <div class="content-tabs">
                    <div class="content-tab active" data-tab="details">Details</div>
                    <div class="content-tab" data-tab="specs">Specifications</div>
                    <div class="content-tab" data-tab="media">Media Gallery</div>
                </div>
            `;
            
            // Tab content - Details
            detailContent.innerHTML += `
                <div class="tab-content active" id="tab-details">
                    <h2 class="section-title">Description</h2>
                    <div class="description">${currentRobot.description || 'No detailed description available.'}</div>
                    
                    ${currentRobot.manufacturer?.website ? `
                        <div class="manufacturer-info">
                            <h2 class="section-title">Manufacturer Information</h2>
                            <p><a href="${currentRobot.manufacturer.website}" target="_blank">${currentRobot.manufacturer.name} Website</a></p>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Tab content - Specifications
            let specsContent = `
                <div class="tab-content" id="tab-specs">
                    <h2 class="section-title">Technical Specifications</h2>
            `;
            
            // Check if we have specifications
            if (currentRobot.specifications) {
                specsContent += '<div class="specs-grid">';
                
                // Physical specs
                if (currentRobot.specifications.physical) {
                    if (currentRobot.specifications.physical.height && currentRobot.specifications.physical.height.value) {
                        specsContent += `
                            <div class="spec-item">
                                <div class="spec-label">Height</div>
                                <div class="spec-value">${currentRobot.specifications.physical.height.value} ${currentRobot.specifications.physical.height.unit || ''}</div>
                            </div>
                        `;
                    }
                    
                    if (currentRobot.specifications.physical.weight && currentRobot.specifications.physical.weight.value) {
                        specsContent += `
                            <div class="spec-item">
                                <div class="spec-label">Weight</div>
                                <div class="spec-value">${currentRobot.specifications.physical.weight.value} ${currentRobot.specifications.physical.weight.unit || ''}</div>
                            </div>
                        `;
                    }
                }
                
                // Performance specs
                if (currentRobot.specifications.performance) {
                    if (currentRobot.specifications.performance.speed && currentRobot.specifications.performance.speed.value) {
                        specsContent += `
                            <div class="spec-item">
                                <div class="spec-label">Max Speed</div>
                                <div class="spec-value">${currentRobot.specifications.performance.speed.value} ${currentRobot.specifications.performance.speed.unit || ''}</div>
                            </div>
                        `;
                    }
                    
                    if (currentRobot.specifications.performance.battery && currentRobot.specifications.performance.battery.runtime) {
                        specsContent += `
                            <div class="spec-item">
                                <div class="spec-label">Battery Runtime</div>
                                <div class="spec-value">${currentRobot.specifications.performance.battery.runtime} minutes</div>
                            </div>
                        `;
                    }
                }
                
                specsContent += '</div>';
            } else {
                specsContent += '<p>No detailed specifications available.</p>';
            }
            
            specsContent += '</div>';
            detailContent.innerHTML += specsContent;
            
            // Tab content - Media Gallery
            let mediaContent = `
                <div class="tab-content" id="tab-media">
            `;
            
            // Image gallery
            if (currentRobot.media && currentRobot.media.images && currentRobot.media.images.length > 0) {
                mediaContent += `
                    <h2 class="section-title">Image Gallery</h2>
                    <div class="gallery" id="image-gallery">
                `;
                
                // Store gallery images for the modal
                galleryImages = currentRobot.media.images;
                
                currentRobot.media.images.forEach((image, index) => {
                    mediaContent += `
                        <div class="gallery-item" data-index="${index}">
                            <img src="${image.url}" alt="${image.alt || currentRobot.name}" onerror="this.src='images/robot-placeholder.jpg'">
                            ${image.caption ? `<div class="gallery-caption">${image.caption}</div>` : ''}
                        </div>
                    `;
                });
                
                mediaContent += '</div>';
            }
            
            // Videos
            if (currentRobot.media && currentRobot.media.videos && currentRobot.media.videos.length > 0) {
                mediaContent += `
                    <h2 class="section-title">Videos</h2>
                `;
                
                currentRobot.media.videos.forEach(video => {
                    mediaContent += `<div class="video-section">`;
                    
                    // Different handling based on video type
                    if (video.type === 'youtube') {
                        const youtubeId = extractYouTubeId(video.url);
                        if (youtubeId) {
                            mediaContent += `
                                <div class="video-container">
                                    <iframe 
                                        src="https://www.youtube.com/embed/${youtubeId}" 
                                        title="${video.title || 'YouTube video'}"
                                        frameborder="0" 
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                        allowfullscreen>
                                    </iframe>
                                </div>
                            `;
                        }
                    } else if (video.type === 'mp4') {
                        mediaContent += `
                            <div class="video-container">
                                <video controls>
                                    <source src="${video.url}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            </div>
                        `;
                    } else if (video.type === 'external' || video.type === 'url') {
                        mediaContent += `
                            <div class="video-link">
                                <a href="${video.url}" target="_blank" class="btn">
                                    <i class="fas fa-external-link-alt"></i> 
                                    ${video.title || 'Watch Video'}
                                </a>
                            </div>
                        `;
                    }
                    
                    // Video title and description
                    if (video.title) {
                        mediaContent += `<h3 class="video-title">${video.title}</h3>`;
                    }
                    
                    if (video.description) {
                        mediaContent += `<p class="video-description">${video.description}</p>`;
                    }
                    
                    mediaContent += `</div>`;
                });
            }
            
            mediaContent += '</div>';
            detailContent.innerHTML += mediaContent;
            
            // Add the detail content to the container
            detailsContainer.appendChild(detailContent);
            
            // Set up tab switching
            setupTabs();
            
            // Setup gallery click handlers
            setupGalleryClicks();
        }
        
        // Setup content tabs
        function setupTabs() {
            const tabs = document.querySelectorAll('.content-tab');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Get the tab ID
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and tab contents
                    document.querySelectorAll('.content-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and its content
                    this.classList.add('active');
                    document.getElementById('tab-' + tabId).classList.add('active');
                });
            });
        }
        
        // Setup gallery image clicks
        function setupGalleryClicks() {
            const galleryItems = document.querySelectorAll('.gallery-item');
            
            galleryItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Get the image index
                    const index = parseInt(this.getAttribute('data-index'));
                    
                    // Open the modal with this image
                    openGalleryModal(index);
                });
            });
        }
        
        // Setup gallery modal
        function setupGalleryModal() {
            const modal = document.getElementById('gallery-modal');
            const closeBtn = document.getElementById('modal-close');
            const prevBtn = document.getElementById('modal-prev');
            const nextBtn = document.getElementById('modal-next');
            
            // Close modal on close button click
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    modal.classList.remove('active');
                });
            }
            
            // Close modal on outside click
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            }
            
            // Previous image button
            if (prevBtn) {
                prevBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showGalleryImage(currentImageIndex - 1);
                });
            }
            
            // Next image button
            if (nextBtn) {
                nextBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showGalleryImage(currentImageIndex + 1);
                });
            }
            
            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (!modal.classList.contains('active')) return;
                
                if (e.key === 'Escape') {
                    modal.classList.remove('active');
                } else if (e.key === 'ArrowLeft') {
                    showGalleryImage(currentImageIndex - 1);
                } else if (e.key === 'ArrowRight') {
                    showGalleryImage(currentImageIndex + 1);
                }
            });
        }
        
        // Open gallery modal
        function openGalleryModal(index) {
            const modal = document.getElementById('gallery-modal');
            
            if (!modal || !galleryImages || galleryImages.length === 0) return;
            
            // Show the image
            showGalleryImage(index);
            
            // Show the modal
            modal.classList.add('active');
        }
        
        // Show gallery image
        function showGalleryImage(index) {
            if (!galleryImages || galleryImages.length === 0) return;
            
            // Handle index bounds
            if (index < 0) {
                index = galleryImages.length - 1;
            } else if (index >= galleryImages.length) {
                index = 0;
            }
            
            // Set current index
            currentImageIndex = index;
            
            // Update modal content
            const modalImage = document.getElementById('modal-image');
            const modalCaption = document.getElementById('modal-caption');
            
            if (modalImage && modalCaption) {
                // Set the image
                modalImage.innerHTML = `<img src="${galleryImages[index].url}" alt="${galleryImages[index].alt || currentRobot.name}" onerror="this.src='images/robot-placeholder.jpg'">`;
                
                // Set the caption
                modalCaption.textContent = galleryImages[index].caption || '';
            }
        }
        
        // Load related robots
        function loadRelatedRobots() {
            // Get related robots
            const relatedRobots = window.robotsData.getRelatedRobots(robotSlug, 3);
            
            // Get the container
            const relatedRobotsContainer = document.getElementById('related-robots');
            if (!relatedRobotsContainer) return;
            
            // Clear the container
            relatedRobotsContainer.innerHTML = '';
            
            // If no related robots, hide the section
            if (!relatedRobots || relatedRobots.length === 0) {
                const relatedSection = relatedRobotsContainer.closest('.related-robots');
                if (relatedSection) {
                    relatedSection.style.display = 'none';
                }
                return;
            }
            
            // Add robots to the grid
            if (window.robotMediaHandler && typeof window.robotMediaHandler.createRobotCard === 'function') {
                // Use the media handler to create cards
                relatedRobots.forEach(robot => {
                    const robotCard = window.robotMediaHandler.createRobotCard(robot);
                    relatedRobotsContainer.appendChild(robotCard);
                });
            } else {
                // Fallback to basic card creation
                relatedRobots.forEach(robot => {
                    const card = document.createElement('div');
                    card.className = 'robot-card';
                    card.dataset.slug = robot.slug;
                    
                    // Use a placeholder image if no featured image is available
                    let imageUrl = 'images/robot-placeholder.jpg';
                    if (robot.media) {
                        if (robot.media.featuredImage && robot.media.featuredImage.url) {
                            imageUrl = robot.media.featuredImage.url;
                        } else if (robot.media.mainImage && robot.media.mainImage.url) {
                            imageUrl = robot.media.mainImage.url;
                        } else if (robot.media.images && robot.media.images.length > 0) {
                            imageUrl = robot.media.images[0].url;
                        }
                    }
                    
                    card.innerHTML = `
                        <img src="${imageUrl}" alt="${robot.media?.featuredImage?.alt || robot.name}" class="robot-image" onerror="this.src='images/robot-placeholder.jpg'">
                        <div class="robot-content">
                            <h3 class="robot-title">${robot.name || 'Unnamed Robot'}</h3>
                            <p class="robot-desc">${robot.summary || 'No description available.'}</p>
                            <div class="robot-meta">
                                <span>${robot.manufacturer?.name || 'Unknown Manufacturer'}</span>
                            </div>
                        </div>
                    `;
                    
                    // Add click event
                    card.addEventListener('click', () => {
                        window.location.href = `robot-detail.html?slug=${robot.slug}`;
                    });
                    
                    relatedRobotsContainer.appendChild(card);
                });
            }
        }
        
        // Update view count
        function updateViewCount() {
            if (!currentRobot) return;
            
            // Initialize stats if not exists
            if (!currentRobot.stats) {
                currentRobot.stats = { views: 0, favorites: 0 };
            }
            
            // Increment view count
            currentRobot.stats.views = (currentRobot.stats.views || 0) + 1;
            
            // Save changes
            if (window.robotStorage && typeof window.robotStorage.updateRobotAndSave === 'function') {
                window.robotStorage.updateRobotAndSave(currentRobot.id, currentRobot);
            }
        }
        
        // Show error message
        function showError(message) {
            const detailsContainer = document.getElementById('robot-detail-content');
            
            // Clear the container
            if (detailsContainer) {
                detailsContainer.innerHTML = `
                    <div class="error-message" style="text-align: center; padding: 50px 20px;">
                        <div style="font-size: 4rem; color: var(--gray); margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h2 style="font-size: 1.8rem; margin-bottom: 10px;">Error</h2>
                        <p style="color: var(--gray); max-width: 500px; margin: 0 auto 20px;">${message}</p>
                        <a href="encyclopedia.html" class="btn btn-primary">Back to Encyclopedia</a>
                    </div>
                `;
            }
            
            // Hide related robots
            const relatedSection = document.querySelector('.related-robots');
            if (relatedSection) {
                relatedSection.style.display = 'none';
            }
            
            // Hide admin actions
            const adminActions = document.getElementById('admin-actions');
            if (adminActions) {
                adminActions.style.display = 'none';
            }
        }
        
        // Check if user is an admin
        function checkAdminStatus() {
            // Get admin actions container
            const adminActions = document.getElementById('admin-actions');
            if (!adminActions) return;
            
            // Check if user is logged in and is an admin
            const user = window.tgenApp?.getCurrentUser ? window.tgenApp.getCurrentUser() : null;
            const isAdmin = user && user.role === 'admin';
            
            // Show admin controls only to admin users
            adminActions.style.display = isAdmin ? 'block' : 'none';
            
            // Set up admin action buttons
            if (isAdmin) {
                // Edit button
                const editBtn = document.getElementById('edit-robot-btn');
                if (editBtn) {
                    editBtn.addEventListener('click', function() {
                        window.location.href = `admin-form.html?id=${currentRobot.id}`;
                    });
                }
                
                // Delete button
                const deleteBtn = document.getElementById('delete-robot-btn');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function() {
                        if (confirm(`Are you sure you want to delete ${currentRobot.name}? This action cannot be undone.`)) {
                            deleteRobot();
                        }
                    });
                }
            }
        }
        
        // Delete the current robot
        function deleteRobot() {
            // Check if robot exists
            if (!currentRobot || !currentRobot.id) {
                alert('Error: Robot not found.');
                return;
            }
            
            // Delete the robot
            if (window.robotStorage && typeof window.robotStorage.deleteRobotAndSave === 'function') {
                window.robotStorage.deleteRobotAndSave(currentRobot.id)
                    .then(success => {
                        if (success) {
                            alert(`${currentRobot.name} has been deleted.`);
                            window.location.href = 'encyclopedia.html';
                        } else {
                            alert('Error: Failed to delete robot. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('Error deleting robot:', error);
                        alert('Error: Failed to delete robot. Please try again.');
                    });
            } else {
                alert('Error: Storage adapter not available.');
            }
        }
        
        // Extract YouTube video ID
        function extractYouTubeId(url) {
            if (!url) return null;
            
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^\"&?\/\s]{11})/i;
            const match = url.match(regex);
            
            return match ? match[1] : null;
        }
    </script>
</body>
</html>
